<dom-module id="color-picker-utils">
  <script>
    // eslint-disable-next-line no-unused-vars
    class ColorPickerUtils {

      static roundToNearest(value, nearest) {
        nearest = 1 / (nearest);
        return Math.round(value * nearest) / nearest;
      }

      static limit(value, min, max) {
        value = +value;
        return isNaN(value) ? min : (value < min ? min : (value > max ? max : value));
      }

      static conditionallySetAttribute(element, condition, attr) {
        if (condition) {
          element.setAttribute(attr, '');
        } else {
          element.removeAttribute(attr);
        }
      }

      static getContrastColor(color) {
        return color.luminance() >= 0.5 || color.alpha() <= 0.5
          ? color.alpha(1).set('hsl.s', 1).set('hsl.l', .5)
            .darken(color.alpha() <= 0.5 && color.luminance() <= 0.5 ? 1.5 : 2.5).css()
          : color.alpha(1).set('hsl.s', 1).set('hsl.l', .5)
            .brighten(2.5).css();
      }

      static getFormattedColor(color, format, stepAlpha, step) {
        const colorInternal = color.alpha(ColorPickerUtils.roundToNearest(color.alpha(), stepAlpha));

        if ('hex' === format) {
          return colorInternal.hex();
        } else {
          const regex = colorInternal.alpha() === 1 ? /(\d+\.\d+)/gm : /(\d+\.\d+(?=,))/gm;
          return colorInternal.css(format).replace(regex, match => {
            console.info(match);
            return ColorPickerUtils.roundToNearest(match, step);
          });
        }
      }
    }
  </script>
</dom-module>
