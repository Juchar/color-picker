<link href="../../../vaadin-text-field/src/vaadin-text-field.html" rel="import">
<link href="color-picker-color-input.html" rel="import">
<link href="../libraries/chroma-js-import.html" rel="import"/>

<dom-module id="hex-input">
  <template>
    <vaadin-text-field autocomplete="on" clear-button-visible
                       disabled$="[[disabled]]" error-message="Not a valid hex color."
                       label="HEX"
                       pattern="[[_getPattern(disableAlpha)]]"
                       style="width: 100%"
                       theme$="color-value-text-field [[theme]]"
                       value="{{hex}}">
      <div slot="prefix">#</div>
    </vaadin-text-field>
  </template>
  <script>
    (function() {

      /**
       * `<hex-input>` is an element that allows to input **hex** color codes.
       *
       * @memberof Vaadin.ColorPicker
       */
      class HexInputElement extends Vaadin.ColorPicker.ColorInputElement {

        static get is() {
          return 'hex-input';
        }

        static get version() {
          return '0.7.9';
        }

        static get properties() {
          return {
            /**
             * The color value as hex without the leading `#`.
             * Includes alpha value if enabled (e.g. `#FF00FF00`).
             */
            hex: {
              type: String,
              value: '000000',
              notify: true
            }
          };
        }

        /**
         * @constructor
         */
        constructor() {
          super();

          this._observedInputProperties = ['hex'];
          this._colorSupplier = () => chroma.hex('#' + this.hex);
          this._toInputConverter = color => this.hex = color ? color.hex().replace('#', '') : '';
        }

        /**
         * Returns the input validation pattern.
         * @returns {string} The pattern depending on the setting of `disableAlpha`.
         * @private
         */
        _getPattern() {
          if (this.disableAlpha) {
            return '([a-fA-F0-9]{6}|[a-fA-F0-9]{3})';
          } else {
            return '([a-fA-F0-9]{8}|[a-fA-F0-9]{6}|[a-fA-F0-9]{3})';
          }
        }
      }

      customElements.define(HexInputElement.is, HexInputElement);

      /**
       * @namespace Vaadin.ColorPicker
       */
      window.Vaadin = window.Vaadin || {};
      window.Vaadin.ColorPicker = window.Vaadin.ColorPicker || {};
      window.Vaadin.ColorPicker.HexInputElement = HexInputElement;
    })();
  </script>
</dom-module>
