<link href="../../../vaadin-text-field/src/vaadin-number-field.html" rel="import">
<link href="color-picker-color-input.html" rel="import">
<link href="../libraries/chroma-js-import.html" rel="import"/>

<dom-module id="rgba-input">
  <template>
    <style include="color-picker-shared-styles">
    </style>

    <div class="horizontal-spacing">
      <vaadin-number-field disabled$="[[disabled]]" label="R" max="255" min="0" minlength="1"
                           prevent-invalid-input
                           theme$="color-value-text-field align-center [[theme]]"
                           value="{{red}}"></vaadin-number-field>
      <vaadin-number-field disabled$="[[disabled]]" label="G" max="255" min="0" minlength="1"
                           prevent-invalid-input
                           theme$="color-value-text-field align-center [[theme]]"
                           value="{{green}}"></vaadin-number-field>
      <vaadin-number-field disabled$="[[disabled]]" label="B" max="255" min="0" minlength="1"
                           prevent-invalid-input
                           theme$="color-value-text-field align-center [[theme]]"
                           value="{{blue}}"></vaadin-number-field>
      <vaadin-number-field disabled$="[[disabled]]"
                           hidden$="{{disableAlpha}}"
                           label="A"
                           max="1"
                           min="0"
                           minlength="1"
                           prevent-invalid-input
                           step="0.01"
                           theme$="color-value-text-field align-center [[theme]]"
                           value="{{alpha}}"></vaadin-number-field>
    </div>
  </template>
  <script>
    (function() {

      /**
       * `<rgba-input>` is an element that allows to input **rgba** color codes.
       *
       * @memberof Vaadin.ColorPicker
       */
      class RgbaInputElement extends Vaadin.ElementMixin(Vaadin.ThemableMixin(
        Vaadin.ColorPicker.ColorInputElement)) {

        static get is() {
          return 'rgba-input';
        }

        static get version() {
          return '0.6.0';
        }

        static get properties() {
          return {
            /**
             * The current red value in the range `[0 - 255]`.
             */
            red: {
              type: Number,
              value: 0,
              notify: true
            },
            /**
             * The current green value in the range `[0 - 255]`.
             */
            green: {
              type: Number,
              value: 0,
              notify: true
            },
            /**
             * The current blue value in the range `[0 - 255]`.
             */
            blue: {
              type: Number,
              value: 0,
              notify: true
            },
            /**
             * The current alpha in the range `[0 - 1]`.
             */
            alpha: {
              type: Number,
              value: 1,
              notify: true
            }
          };
        }

        /**
         * @constructor
         */
        constructor() {
          super();

          this._observedInputProperties = ['red', 'green', 'blue', 'alpha'];

          this._colorSupplier = () => chroma
            .rgb(parseFloat(this.red),
              parseFloat(this.green),
              parseFloat(this.blue))
            .alpha(parseFloat(this.alpha));

          this._toInputConverter = color => {
            if (color) {
              const rgb = color.rgb();
              this.red = rgb[0];
              this.green = rgb[1];
              this.blue = rgb[2];
              this.alpha = color.alpha();
            } else {
              this.red = '';
              this.green = '';
              this.blue = '';
              this.alpha = '';
            }
          };
        }
      }

      customElements.define(RgbaInputElement.is, RgbaInputElement);

      /**
       * @namespace Vaadin.ColorPicker
       */
      window.Vaadin = window.Vaadin || {};
      window.Vaadin.ColorPicker = window.Vaadin.ColorPicker || {};
      window.Vaadin.ColorPicker.RgbaInputElement = RgbaInputElement;
    })();
  </script>
</dom-module>
